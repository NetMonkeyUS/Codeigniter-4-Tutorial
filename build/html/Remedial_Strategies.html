

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Remedial strategies &mdash; Codeigniter 4 Turbo 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Codeigniter 4 Turbo 1.0.0 documentation" href="index.html"/>
        <link rel="next" title="Added resources" href="Added_Resources.html"/>
        <link rel="prev" title="Go Live Problems" href="Go_Live_Problems.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Codeigniter 4 Turbo
          

          
            
            <img src="_static/NetMonkeyUsLogo.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Purpose.html">Purpose: Why another tutorial?</a></li>
<li class="toctree-l1"><a class="reference internal" href="Go_Live_Problems.html">Go Live Problems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Remedial strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#move-css-and-images-and-js-folders">Move css and images and js folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#turbocharge-file-structure-better-but-more-complicated">Turbocharge file structure (Better but more complicated)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pros-and-cons-to-this-structure">Pros and cons to this structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Added_Resources.html">Added resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting_Started_Playbook.html">Getting Started Playbook</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Codeigniter 4 Turbo</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Remedial strategies</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Remedial_Strategies.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="remedial-strategies">
<h1>Remedial strategies<a class="headerlink" href="#remedial-strategies" title="Permalink to this headline">¶</a></h1>
<div class="section" id="move-css-and-images-and-js-folders">
<h2>Move css and images and js folders<a class="headerlink" href="#move-css-and-images-and-js-folders" title="Permalink to this headline">¶</a></h2>
<p>You can have your assets (js css &amp; images) in the project root on your local machine and in your public folder on your live hosting. This is probably the easiest answer but a little disturbing. You shouldn’t have to trick things right out of the box.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Is this really true or did I just screw something up on the first goround? Need to retest.</p>
</div>
</div>
<div class="section" id="turbocharge-file-structure-better-but-more-complicated">
<h2>Turbocharge file structure (Better but more complicated)<a class="headerlink" href="#turbocharge-file-structure-better-but-more-complicated" title="Permalink to this headline">¶</a></h2>
<p>I forked this from this web page: <a class="reference external" href="https://forum.codeigniter.com/thread-75774.html">https://forum.codeigniter.com/thread-75774.html</a></p>
<ul>
<li><p>Change the name of your project folder (initially framework-4.1.1 or something) to ‘ci4_project’ for the sake of clarity.</p></li>
<li><p>Inside the ‘ci4_project’ folder, change the name of your ‘public’ folder to ‘public_html’ to mimic the folder structure of your hosting.</p></li>
<li><p>Make a new folder inside ‘public_html’ called ‘mydomain.com’ or whatever locally duplicates your live domain. (Always replace the term ‘mydomain’ with your real domain name.)</p></li>
<li><p>Move EVERYTHING in ‘public_html’ into the subfolder ‘mydomain.com’.</p></li>
<li><p>Create a new folder named ‘ci4_code’ (or whatever you want to call it) inside the ‘ci4_project’ folder.</p></li>
<li><p>Move everything that ISN’T in the ‘public_html’ folder into the ‘ci4_code’ folder EXCEPT the file ‘spark’.</p></li>
<li><p>Change FCPATH in ‘public_html/index.php’ (at or about line 28) (my comments are in CAPITALS):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Load our paths config file
// This is the line that might need to be changed, depending on your folder structure.
//CHANGED THIS PER https://forum.codeigniter.com/thread-75774.html
require realpath(FCPATH . &#39;../../ci4_code/app/Config/Paths.php&#39;) ?: FCPATH . &#39;../../ci4_code/app/Config/Paths.php&#39;;
// ^^^ Change this if you move your application folder
</pre></div>
</div>
</li>
<li><p>Change ‘FCPATH’ and ‘realpath’ in ‘ci4_project/spark’ file (starting at about line 40):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Path to the front controller
//CHANGED THIS PER https://forum.codeigniter.com/thread-75774.html
define(&#39;FCPATH&#39;, __DIR__ . DIRECTORY_SEPARATOR . &#39;public_html&#39;. DIRECTORY_SEPARATOR . &#39;mydomain.com&#39; . DIRECTORY_SEPARATOR);

// Load our paths config file
//CHANGED THIS TO POINT TO RIGHT FILE
require realpath(&#39;ci4_code/app/Config/Paths.php&#39;) ?: &#39;ci4_code/app/Config/Paths.php&#39;;
// ^^^ Change this line if you move your application folder
</pre></div>
</div>
</li>
<li><p>The ‘ci4_project/spark’ file can have any name. Just make sure your code editor doesn’t save an extension like ‘.txt’ or ‘.php’ on the end. We’ll call it ‘spark_mydomain’. That way if you want to use CodeIgniter4 on any other local domains, all you have to do is change the ‘spark’ file.</p></li>
</ul>
<p>Here’s where it gets tricky. With where you are so far, if you have multiple domains using the ‘ci4_code’ folder they are all going to be using the same ‘.env’ file which I don’t think will work. There might be other ways of getting around this, but what follows is the work-around I used. It seems to work, but I don’t know about security – and as well you have to alter a CodeIgniter system file which is supposed to be a ‘no-no’.</p>
<ul>
<li><p>Go to your ‘.env’ file. Save a copy as ‘.env.mydomain.com’ (where ‘mydomain.com’ is your real domain). ALSO, save a copy as ‘.env.localhost’. Put your localhost base_URL and database settings in ‘.env.localhost’.</p></li>
<li><p>Open this file ‘ci4_projects/ci4_code/vendor/codeigniter4/framework/system/Config/DotEnv.php’.</p></li>
<li><p>At about line 38 in ‘DotEnv.php’ it tells the app where to find the ‘.env’ file. At first I simply appended ‘.mydomain.com’ automatically to the end of the ‘$file’ variable using $_SERVER[‘SERVER_NAME’]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public function __construct(string $path, string $file = &#39;.env&#39;)
{
        /* ADDED THIS FROM https://stackoverflow.com/questions/17201170/php-how-to-get-the-base-domain-url */

        $file = $file . &#39;.&#39; . ($_SERVER[&#39;SERVER_NAME&#39;]);

        $this-&gt;path = rtrim($path, DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR . $file;
}
</pre></div>
</div>
</li>
<li><p>HOWEVER, evidently using $SERVER(‘SERVER_NAME’) is a security risk. To get around this risk it is better to make an array of the ‘okay’ server names and check against it so I modified the code to as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public function __construct(string $path, string $file = &#39;.env&#39;)
{
        /* SOURCES:
        https://stackoverflow.com/questions/17201170/php-how-to-get-the-base-domain-url
        https://expressionengine.com/blog/http-host-and-server-name-security-issues
        */

        $domains = array(&#39;mydomain.com&#39;, &#39;myotherdomain.com&#39;, &#39;localhost&#39;);

        if (in_array($_SERVER[&#39;SERVER_NAME&#39;], $domains)){
                $domain = $_SERVER[&#39;SERVER_NAME&#39;];
                //echo &quot;Serving from verfied domain: &quot; . $domain;       // for testing
                $domain = &#39;.&#39; . $domain;
                } else {
                        //echo &#39;error -- Potential hack attack&#39;;                // for testing
                        $domain = &#39;&#39;;
                }

        /*BACK TO ORIGINAL CODE except added &#39;.domain&#39;*/
        $this-&gt;path = rtrim($path, DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR . $file . $domain;

}
</pre></div>
</div>
</li>
<li><p>BUT ANOTHER PROBLEM is that in order to modify your server names (in case you add or subtract a domain) you have to dig way into the Codeigniter framework for the DotEnv.php file. To avoid this hassle I cut out the modified code and pasted it into a file called ‘ValidDomains.php’ which we will save in the root (‘ci4_code’) of the project. Luckily the ‘$path’ variable is already maps where we want to be so I just prepended it to ‘ValidDomains.php’. Here is the end result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&#39;ValidDomains.php&#39; in root (aka &#39;ci4_code/ValidDomains.php&#39;)

        &lt;?php

                /* SOURCES:
                https://stackoverflow.com/questions/17201170/php-how-to-get-the-base-domain-url
                https://expressionengine.com/blog/http-host-and-server-name-security-issues
                https://stackoverflow.com/questions/13234122/index-server-name-not-exist */

                $server_name = (isset($_SERVER[&#39;SERVER_NAME&#39;]))?        // check if SERVER_NAME is set
                $_SERVER[&#39;SERVER_NAME&#39;] :                                                       // if yes, use HTTP header value
                php_uname(&quot;n&quot;);                                                                         // if no, use php_uname()

                $domains = [
                        &#39;mydomain.com&#39;,
                        &#39;myotherdomain.org&#39;,
                        &#39;localhost&#39;
                ];

                if (in_array($server_name, $domains)){
                        $domain = $server_name;
                        //echo &quot;Serving from verfied domain: &quot; . $domain;       //for testing
                        $domain = &#39;.&#39; . $domain;                        //add the dot here is better

                        } else {
                                //echo &#39;error -- Potential hack attack&#39;;                //for testing
                                $domain = &#39;&#39;;
                        }

                $file = ($file . $domain);

And the altered code within &#39;/vendor/codeigniter4/framework/system/Config/DotEnv.php&#39; (at about line 40)::

        public function __construct(string $path, string $file = &#39;.env&#39;)
        {
                /* put in higher directory so easier to access */
                require ($path . DIRECTORY_SEPARATOR . &#39;ValidDomains.php&#39;);

                /*BACK TO ORIGINAL CODE*/
                $this-&gt;path = rtrim($path, DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR . $file;

        }
</pre></div>
</div>
</li>
<li><p>The last step is to upload the modified folder structure to your live domain in the corresponding folders, and change the ‘.env.mydomain.com’ file to match your live info. Your ‘Config/App.php’ and ‘Config/Database’ don’t seem to have any effect as long as you have a working dotenv file (in our case ‘.env.mydomain.com’).</p></li>
</ul>
<p>Also you should change from ‘development’ to ‘production’ in your ‘.env.mydomain.com’ file on your live server. You might want to add your custom dotenv file (.env.mydomain.com) to your ‘.gitignore’ file on the same level though I don’t know enough about it to know for sure. Like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------</span>
<span class="n">ADDED</span> <span class="n">THIS</span> <span class="k">for</span> <span class="n">my</span> <span class="n">multi</span><span class="o">-</span><span class="n">domain</span> <span class="n">work</span><span class="o">-</span><span class="n">around</span>
<span class="c1">#-----------------------</span>
<span class="o">.</span><span class="n">env</span><span class="o">*</span>
</pre></div>
</div>
<p>With this set up you should be good to develop locally and just drag and drop to your live site.</p>
</div>
<div class="section" id="pros-and-cons-to-this-structure">
<h2>Pros and cons to this structure<a class="headerlink" href="#pros-and-cons-to-this-structure" title="Permalink to this headline">¶</a></h2>
<p>The plusses of this structure is that it is more secure. Most of your code is not web accessible. Also, it takes less space on your server if you are going to run multiple websites.</p>
<p>The ‘cons’ of this way of doing it this way is that your ‘views’ folder and ‘Config/Routes.php’ are going to be more crowded, with multiple websites being referenced. There are ways to adapt to this like having separate subfolders for each website in the ‘views’ folder, and grouping the different website routes together somehow.</p>
<p>But there are advantages even in the crowdedness. You might be able to reuse controllers on different sites. Maybe your ‘Login’ controller or some other controller will work just fine on both ‘mydomain.com’ and ‘my_otherdomain.com’ even though it accesses a different database. Your unique content will be in your ‘public_html’ folder. Your structure is in the ‘app’ folder and might not need to be unique.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>test with real install</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Added_Resources.html" class="btn btn-neutral float-right" title="Added resources" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Go_Live_Problems.html" class="btn btn-neutral" title="Go Live Problems" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Alec Fishbane.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Stanford-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>